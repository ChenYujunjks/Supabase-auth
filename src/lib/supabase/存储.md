
> âœ… **æ­¤æ—¶ Supabase çš„ JWT æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿä¼šä¸ä¼šæœ‰å¤šä¸ªå­˜å‚¨æ–¹å¼å¹¶å­˜ï¼Ÿ**

---

## âœ… ç­”æ¡ˆæ€»ç»“ï¼šç¡®å®ä¼šå­˜åœ¨ã€Œä¸¤ç§å­˜å‚¨æœºåˆ¶ã€å¹¶è¡Œ

| åœºæ™¯                | ä½¿ç”¨å“ªç§ Supabase Client    | å­˜å‚¨æ–¹å¼           | å­˜å‚¨ä½ç½®             |
| ----------------- | ----------------------- | -------------- | ---------------- |
| ğŸ–¥ å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®é¡µé¢     | `createBrowserClient()` | `localStorage` | æµè§ˆå™¨å†…å­˜æŒä¹…åŒ–         |
| âš™ï¸ æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å¤„ç†è¯·æ±‚ | `createServerClient()`  | `cookies()`    | è¯·æ±‚ä¸­çš„ HTTP cookie |

è¿™ä¸¤è€…æ˜¯**ç‹¬ç«‹è¿è¡Œçš„å­˜å‚¨æœºåˆ¶**ï¼Œäº’ä¸å¹²æ‰°ï¼Œä½†å¯ä»¥é€šè¿‡ `supabase/ssr` åŒ…ä¸­çš„ `middleware` å®ç°ã€Œå‰åç«¯ session åŒæ­¥ã€ã€‚

---

## âœ… æµç¨‹å›¾è§£ï¼šä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ

```
ğŸ” ç”¨æˆ·åœ¨å®¢æˆ·ç«¯ç™»å½•
   â†“
ğŸ“¦ JWT è¢«è‡ªåŠ¨å­˜å…¥ localStorageï¼ˆç”± createBrowserClient å¤„ç†ï¼‰

ğŸŒ ç”¨æˆ·è®¿é—® SSR é¡µé¢ï¼ˆæˆ–åˆ·æ–°é¡µé¢ï¼‰
   â†“
ğŸ§  ä¸­é—´ä»¶ middleware.ts ä» cookie ä¸­è¯»å– JWT
   â†“
ğŸ›  createServerClient ä½¿ç”¨ cookie æ¢å¤ sessionï¼ŒéªŒè¯æƒé™
   â†“
ğŸ“¤ å“åº”é¡µé¢ï¼Œé¡µé¢åŠ è½½å®Œæˆ

ğŸ–¥ å®¢æˆ·ç«¯åŠ è½½å®Œé¡µé¢åï¼Œé‡æ–°åˆå§‹åŒ– createBrowserClient
   â†“
ğŸ“¦ localStorage ä¸­ JWT è‡ªåŠ¨ç»§ç»­ç”Ÿæ•ˆ
```

---

## âœ… æ˜¯å¦ã€Œä¸¤ä¸ªåœ°æ–¹éƒ½å­˜ã€ï¼Ÿ

æ˜¯çš„ï¼Œä½†å®ƒä»¬çš„ä½œç”¨ä¸åŒï¼š

| å­˜å‚¨             | ç”¨äºä»€ä¹ˆ             | ç”Ÿå‘½å‘¨æœŸ        | æ›¿ä»£æ€§                 |
| -------------- | ---------------- | ----------- | ------------------- |
| `localStorage` | å‰ç«¯è¯·æ±‚æ—¶æŒä¹…ä¿å­˜ç”¨æˆ·ç™»å½•    | é¡µé¢åˆ·æ–°ä¿ç•™      | âœ… å¯æ”¹ä¸º cookie        |
| `cookie`       | SSR æ—¶è¯»å– JWTï¼Œæ‰§è¡Œé‰´æƒ | HTTP è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ | âœ… é»˜è®¤ç”± middleware è®¾ç½® |

---

## âœ… å¤šå­˜æ˜¯å¦æœ‰å†²çªï¼Ÿ

ä¸ä¼šã€‚å› ä¸ºï¼š

* SSR çš„ `createServerClient()` **åªç”¨ cookie**
* å®¢æˆ·ç«¯çš„ `createBrowserClient()` **åªç”¨ localStorage**

å®ƒä»¬å„è‡ªç‹¬ç«‹ï¼Œä½†ä½ éœ€è¦ç¡®ä¿å®ƒä»¬ **åŒæ­¥ç™»å½•çŠ¶æ€**ï¼Œè€Œè¿™å°±æ˜¯ï¼š

```ts
// middleware.ts ä¸­çš„ä½œç”¨
import { updateSession } from '@supabase/ssr'

export async function middleware(request) {
  return await updateSession(request);
}
```

---

## âœ… ä½ åº”è¯¥å…³æ³¨çš„é‡ç‚¹æ˜¯ï¼š

### âœ… æ˜¯å¦ä½¿ç”¨äº† `middleware.ts` æ¥åŒæ­¥ sessionï¼Ÿ

è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨æ˜¯ï¼š

* ç”¨æˆ·ç™»å½•/ç™»å‡ºæ—¶ï¼Œæ›´æ–° cookie ä¸­çš„ JWTï¼Œç¡®ä¿ SSR æœ‰æƒé™è®¿é—®
* è‡ªåŠ¨å¤„ç† cookie <-> Supabase Server Client çš„åŒæ­¥

---

## ğŸ”§ æƒ³éªŒè¯æ˜¯å¦åŒæ­¥æˆåŠŸï¼Ÿ

ä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ç¡®è®¤ï¼š

### 1. ç™»å½•åæ‰“å¼€æµè§ˆå™¨ `localStorage`

ç¡®è®¤æœ‰ï¼š

```
supabase.auth.token
```

### 2. æ‰“å¼€ `Application â†’ Cookies`

ç¡®è®¤æœ‰ï¼š

```
sb-access-token, sb-refresh-token
```

ï¼ˆè¿™äº›å°±æ˜¯ middleware è®¾ç½®çš„ cookieï¼Œä¾› SSR ç”¨ï¼‰

---

## âœ… æœ€ä½³å®è·µå»ºè®®

| åœºæ™¯                | å»ºè®®åšæ³•                                                  |
| ----------------- | ----------------------------------------------------- |
| å®¢æˆ·ç«¯éœ€è¦é•¿æœŸä¿æŒç™»å½•çŠ¶æ€     | ä½¿ç”¨ `createBrowserClient()` + é»˜è®¤ localStorage          |
| æœåŠ¡ç«¯ SSR éœ€è¦é‰´æƒ      | é…ç½®å¥½ `middleware.ts` + `createServerClient()` + cookie |
| å®‰å…¨æ€§æ›´é«˜çš„é¡¹ç›®ï¼ˆå¦‚ adminï¼‰ | å°† client SDK æ”¹ä¸ºä½¿ç”¨ cookie å­˜å‚¨ tokenï¼ˆå¯é…ç½®ï¼‰                |
